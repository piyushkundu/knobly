<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Knobly — PDF Toolkit</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=Rajdhani:wght@700&display=swap" rel="stylesheet">

  <!-- PDF libraries -->
  <script src="https://unpkg.com/pdf-lib/dist/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

  <style>
    /* ---------- Base ---------- */
    :root{
      --accent:#06b6d4;
      --bg:#f7fbfd;
      --card:#ffffff;
      --muted:#6b7280;
      --glass-border: rgba(6,182,212,0.12);
      --radius:14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:"Outfit",system-ui,-apple-system,Roboto,"Helvetica Neue",Arial; background:var(--bg); color:#09203a;-webkit-font-smoothing:antialiased}
    a{color:var(--accent);text-decoration:none}
    .container{max-width:1100px;margin:26px auto;padding:18px}

    /* ---------- Header ---------- */
    .header{
      display:flex;align-items:center;justify-content:space-between;
      background:linear-gradient(180deg,#ffffff,#fbfdfe);
      border:1px solid var(--glass-border); border-radius:18px; padding:14px 18px;
      box-shadow:0 8px 30px rgba(9,32,46,0.06);
    }
    .brand{display:flex;gap:12px;align-items:center}
    .logo{
      width:56px;height:56px;border-radius:12px;
      background:linear-gradient(135deg,var(--accent),#7dd3fc); display:flex;align-items:center;justify-content:center;
      color:#022b33;font-weight:800;font-size:20px; box-shadow:0 8px 20px rgba(6,182,212,0.12)
    }
    .title{font-family:"Rajdhani",sans-serif;letter-spacing:0.08em;font-size:20px}
    .subtitle{color:var(--muted);font-size:13px}

    /* ---------- Layout ---------- */
    .main{display:grid;grid-template-columns:1fr 360px;gap:18px;margin-top:18px}
    @media(max-width:1000px){ .main{grid-template-columns:1fr} }

    .card{
      background:var(--card); border-radius:var(--radius); padding:16px;
      border:1px solid var(--glass-border); box-shadow:0 8px 24px rgba(9,32,46,0.04)
    }
    h3{margin:0 0 8px 0;font-size:16px}
    p.note{margin:0;color:var(--muted);font-size:13px}

    /* ---------- form elements ---------- */
    .file-input{display:block;width:100%;padding:10px;border-radius:10px;border:1px dashed rgba(9,32,46,0.06);background:#fbfeff}
    .input{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(9,32,46,0.06);background:#fff}
    .row{display:flex;gap:10px;align-items:center}
    .btn{
      display:inline-flex;align-items:center;gap:8px;cursor:pointer;border:none;padding:10px 14px;border-radius:10px;
      background:linear-gradient(90deg,var(--accent),#7dd3fc); color:#022b33;font-weight:700;box-shadow:0 8px 18px rgba(6,182,212,0.08)
    }
    .btn.ghost{
      background:transparent;border:1px solid var(--glass-border);color:var(--accent);font-weight:700
    }
    .muted{color:var(--muted);font-size:13px}

    /* ---------- file list ---------- */
    .file-list{display:flex;flex-direction:column;gap:8px;margin-top:10px}
    .file-item{display:flex;align-items:center;justify-content:space-between;padding:10px;border-radius:10px;background:#fbfeff;border:1px solid rgba(9,32,46,0.03)}
    .file-meta{font-size:13px;color:#052434}
    .small{font-size:12px;color:var(--muted)}

    /* ---------- extracted text ---------- */
    pre.extract{white-space:pre-wrap;max-height:320px;overflow:auto;padding:12px;background:#fbfeff;border-radius:8px;border:1px solid rgba(9,32,46,0.03);margin-top:10px}

    /* ---------- loader overlay ---------- */
    .overlay{position:fixed;inset:0;background:rgba(2,6,23,0.28);display:flex;align-items:center;justify-content:center;z-index:999;visibility:hidden;opacity:0;transition:all .18s}
    .overlay.show{visibility:visible;opacity:1}
    .spinner{
      width:120px;height:120px;border-radius:16px;background:linear-gradient(180deg,#ffffff,#f3fbff);display:flex;align-items:center;justify-content:center;flex-direction:column;padding:14px;border:1px solid rgba(255,255,255,0.06);
      box-shadow:0 10px 30px rgba(2,6,23,0.3)
    }
    .dot{width:12px;height:12px;border-radius:50%;background:var(--accent);margin:6px;display:inline-block;animation:spin 1s infinite ease-in-out}
    @keyframes spin{0%{transform:scale(1)}50%{transform:scale(.4)}100%{transform:scale(1)}}

    /* ---------- footer ---------- */
    .foot{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="container">

    <!-- HEADER -->
    <div class="header">
      <div class="brand">
        <div class="logo">K</div>
        <div>
          <div class="title">Knobly PDF Toolkit</div>
          <div class="subtitle">Fast tools — Merge · Split · Extract · Images→PDF</div>
        </div>
      </div>
      <div class="muted">Designed for students — click an action and wait a moment for processing</div>
    </div>

    <!-- MAIN -->
    <div class="main">

      <!-- LEFT: Tools -->
      <div style="display:flex;flex-direction:column;gap:14px">
        <!-- Merge -->
        <div class="card">
          <h3>Merge PDFs</h3>
          <p class="note">Multiple PDFs चुनें और एक combined PDF बनाइए।</p>

          <label class="small muted" style="display:block;margin-top:12px">Choose PDFs</label>
          <input id="mergeFiles" class="file-input" type="file" accept="application/pdf" multiple>

          <div style="margin-top:12px" class="row">
            <button id="mergeBtn" class="btn">Merge & Download</button>
            <button id="clearMerge" class="btn ghost">Clear</button>
            <div id="mergeInfo" class="small"></div>
          </div>
        </div>

        <!-- Split -->
        <div class="card">
          <h3>Split PDF</h3>
          <p class="note">एक PDF चुनें और page ranges extract करें (example: 1-3,5).</p>

          <label class="small muted" style="display:block;margin-top:12px">Choose PDF</label>
          <input id="splitFile" class="file-input" type="file" accept="application/pdf">

          <label class="small muted" style="display:block;margin-top:10px">Pages to extract</label>
          <input id="pagesSpec" class="input" placeholder="e.g. 1-3,5">

          <div style="margin-top:12px" class="row">
            <button id="splitBtn" class="btn">Extract & Download</button>
            <button id="clearSplit" class="btn ghost">Clear</button>
            <div id="splitInfo" class="small"></div>
          </div>
        </div>

        <!-- Extract -->
        <div class="card">
          <h3>PDF → Text (Extract)</h3>
          <p class="note">Text-based PDFs के लिए अच्छा काम करता है. (Scanned PDFs के लिए OCR जरूरी होगा.)</p>

          <label class="small muted" style="display:block;margin-top:12px">Choose PDF</label>
          <input id="textFile" class="file-input" type="file" accept="application/pdf">

          <div style="margin-top:12px" class="row">
            <button id="extractBtn" class="btn">Extract Text</button>
            <button id="clearExtract" class="btn ghost">Clear</button>
            <div id="extractInfo" class="small"></div>
          </div>

          <pre id="extracted" class="extract" aria-live="polite"></pre>
        </div>

        <!-- Images -> PDF -->
        <div class="card">
          <h3>Images → PDF</h3>
          <p class="note">Multiple images से एक PDF बनाइए (JPG/PNG).</p>

          <label class="small muted" style="display:block;margin-top:12px">Choose images</label>
          <input id="imgFiles" class="file-input" type="file" accept="image/*" multiple>

          <div style="margin-top:12px" class="row">
            <button id="imgToPdfBtn" class="btn">Create PDF</button>
            <button id="clearImg" class="btn ghost">Clear</button>
            <div id="imgInfo" class="small"></div>
          </div>
        </div>
      </div>

      <!-- RIGHT: Side panel (file list, notes) -->
      <div style="display:flex;flex-direction:column;gap:14px">
        <div class="card">
          <h3>Uploaded Files</h3>
          <p class="note">Selected files का quick list — click download to get original.</p>
          <div id="uploaded" class="file-list">
            <div class="file-item"><div class="file-meta">No files selected</div></div>
          </div>
        </div>

        <div class="card">
          <h3>Quick Notes</h3>
          <p class="note">Short memo — saved locally.</p>
          <input id="noteTitle" class="input" placeholder="Title (optional)">
          <textarea id="noteBody" rows="6" class="input" style="margin-top:10px" placeholder="Type quick note..."></textarea>
          <div style="margin-top:10px;display:flex;gap:8px;align-items:center">
            <button id="saveNote" class="btn">Save Note</button>
            <button id="clearNote" class="btn ghost">Clear</button>
          </div>
          <div id="notesList" style="margin-top:10px" class="muted small"></div>
        </div>
      </div>

    </div>

    <div class="foot">Knobly PDF toolkit — client-side processing. For OCR/scanned PDFs use an OCR API integration.</div>
  </div>

  <!-- LOADER OVERLAY -->
  <div id="overlay" class="overlay" role="status" aria-hidden="true">
    <div class="spinner">
      <div style="font-weight:700;color:#042431;margin-bottom:8px">Processing…</div>
      <div style="display:flex"><span class="dot"></span><span class="dot" style="animation-delay:.12s"></span><span class="dot" style="animation-delay:.24s"></span></div>
      <div style="margin-top:10px;color:var(--muted);font-size:13px">This runs in your browser — large files may take a few seconds.</div>
    </div>
  </div>

  <script>
    /* ========= Setup PDF libs ========= */
    const { PDFDocument } = PDFLib;
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

    /* ========= Helpers ========= */
    const overlay = document.getElementById('overlay');
    function showOverlay(show){ overlay.classList.toggle('show', !!show); overlay.setAttribute('aria-hidden', !show); }

    function readFileAsArrayBuffer(file){ return new Promise((res, rej) => {
      const fr = new FileReader();
      fr.onload = ()=> res(fr.result);
      fr.onerror = () => rej(new Error('File read error'));
      fr.readAsArrayBuffer(file);
    }); }

    function readFileAsDataURL(file){ return new Promise((res, rej) => {
      const fr = new FileReader();
      fr.onload = ()=> res(fr.result);
      fr.onerror = () => rej(new Error('File read error'));
      fr.readAsDataURL(file);
    }); }

    function downloadBlob(buf, filename, mime='application/pdf'){
      const blob = new Blob([buf], { type: mime });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename; document.body.appendChild(a); a.click(); a.remove();
      URL.revokeObjectURL(url);
    }

    function formatSize(n){ if(n<1024) return n+' B'; if(n<1024*1024) return Math.round(n/1024)+' KB'; return Math.round(n/(1024*1024))+' MB'; }

    /* ========= UI elements ========= */
    const mergeFiles = document.getElementById('mergeFiles');
    const mergeBtn = document.getElementById('mergeBtn'); const clearMerge = document.getElementById('clearMerge'); const mergeInfo = document.getElementById('mergeInfo');

    const splitFile = document.getElementById('splitFile');
    const pagesSpec = document.getElementById('pagesSpec');
    const splitBtn = document.getElementById('splitBtn'); const clearSplit = document.getElementById('clearSplit'); const splitInfo = document.getElementById('splitInfo');

    const textFile = document.getElementById('textFile');
    const extractBtn = document.getElementById('extractBtn'); const clearExtract = document.getElementById('clearExtract'); const extractInfo = document.getElementById('extractInfo');
    const extracted = document.getElementById('extracted');

    const imgFiles = document.getElementById('imgFiles');
    const imgToPdfBtn = document.getElementById('imgToPdfBtn'); const clearImg = document.getElementById('clearImg'); const imgInfo = document.getElementById('imgInfo');

    const uploaded = document.getElementById('uploaded');

    const noteTitle = document.getElementById('noteTitle');
    const noteBody = document.getElementById('noteBody');
    const saveNote = document.getElementById('saveNote');
    const clearNote = document.getElementById('clearNote');
    const notesList = document.getElementById('notesList');

    /* ========= State: store uploaded files and arrayBuffers ========= */
    const state = {
      merge: [],      // Array of { file, buffer? }
      split: null,    // { file, buffer }
      extract: null,  // { file, buffer }
      images: [],     // Array of { file, dataUrl? }
    };

    function refreshUploadedUI(){
      const rows = [];
      // merge
      if(state.merge.length){
        state.merge.forEach((m, i)=>{
          rows.push(`<div class="file-item"><div><div class="file-meta">${m.file.name}</div><div class="small">${formatSize(m.file.size)} • PDF</div></div><div><button class="btn ghost" data-action="download-merge" data-i="${i}">Download</button></div></div>`);
        });
      }
      // split
      if(state.split) rows.push(`<div class="file-item"><div><div class="file-meta">${state.split.file.name}</div><div class="small">${formatSize(state.split.file.size)} • PDF (split source)</div></div><div><button class="btn ghost" data-action="download-split">Download</button></div></div>`);
      // extract
      if(state.extract) rows.push(`<div class="file-item"><div><div class="file-meta">${state.extract.file.name}</div><div class="small">${formatSize(state.extract.file.size)} • PDF (extract source)</div></div><div><button class="btn ghost" data-action="download-extract">Download</button></div></div>`);
      // images
      if(state.images.length){
        state.images.forEach((im, idx)=>{
          rows.push(`<div class="file-item"><div><div class="file-meta">${im.file.name}</div><div class="small">${formatSize(im.file.size)} • Image</div></div><div><button class="btn ghost" data-action="download-image" data-i="${idx}">Download</button></div></div>`);
        });
      }
      uploaded.innerHTML = rows.length ? rows.join('') : '<div class="file-item"><div class="file-meta">No files selected</div></div>';
    }

    // handle download buttons in uploaded list
    uploaded.addEventListener('click', (e)=>{
      const btn = e.target.closest('button');
      if(!btn) return;
      const action = btn.getAttribute('data-action');
      if(action === 'download-merge'){
        const i = Number(btn.getAttribute('data-i'));
        const m = state.merge[i];
        if(m && m.buffer) downloadBlob(m.buffer, m.file.name);
        else if(m && m.file) { readFileAsArrayBuffer(m.file).then(buf => downloadBlob(buf, m.file.name)); }
      } else if(action === 'download-split' && state.split){
        if(state.split.buffer) downloadBlob(state.split.buffer, state.split.file.name);
        else readFileAsArrayBuffer(state.split.file).then(buf => downloadBlob(buf, state.split.file.name));
      } else if(action === 'download-extract' && state.extract){
        if(state.extract.buffer) downloadBlob(state.extract.buffer, state.extract.file.name);
        else readFileAsArrayBuffer(state.extract.file).then(buf => downloadBlob(buf, state.extract.file.name));
      } else if(action === 'download-image'){
        const i = Number(btn.getAttribute('data-i'));
        const im = state.images[i];
        if(im && im.dataUrl){
          // convert dataUrl to blob and download
          fetch(im.dataUrl).then(r=>r.blob()).then(blob=>{
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href = url; a.download = im.file.name; a.click(); URL.revokeObjectURL(url);
          });
        } else if(im && im.file){
          // fallback
          const url = URL.createObjectURL(im.file); const a = document.createElement('a'); a.href = url; a.download = im.file.name; a.click(); URL.revokeObjectURL(url);
        }
      }
    });

    /* ========= Merge logic ========= */
    mergeFiles.addEventListener('change', async (e) => {
      const files = Array.from(e.target.files || []).filter(f => f.type === 'application/pdf');
      state.merge = files.map(f => ({ file: f }));
      mergeInfo.textContent = `${state.merge.length} file(s) selected`;
      refreshUploadedUI();
      // pre-read buffers (so merging is faster on click)
      for(const item of state.merge){
        if(!item.buffer) {
          try { item.buffer = await readFileAsArrayBuffer(item.file); } catch(err){ /* ignore */ }
        }
      }
    });

    clearMerge.addEventListener('click', ()=>{ mergeFiles.value=''; state.merge = []; mergeInfo.textContent=''; refreshUploadedUI(); });

    mergeBtn.addEventListener('click', async ()=>{
      if(!state.merge.length){ mergeInfo.textContent = 'Please select PDF files first.'; return; }
      showOverlay(true);
      mergeInfo.textContent = 'Merging...';
      try {
        const mergedPdf = await PDFDocument.create();
        for(const item of state.merge){
          const buf = item.buffer || await readFileAsArrayBuffer(item.file);
          const src = await PDFDocument.load(buf);
          const pages = await mergedPdf.copyPages(src, src.getPageIndices());
          pages.forEach(p => mergedPdf.addPage(p));
        }
        const out = await mergedPdf.save();
        downloadBlob(out, 'knobly-merged.pdf');
        mergeInfo.textContent = 'Merged ✅';
      } catch(err){
        mergeInfo.textContent = 'Error while merging.';
      } finally { showOverlay(false); setTimeout(()=>mergeInfo.textContent='', 2200); }
    });

    /* ========= Split logic ========= */
    splitFile.addEventListener('change', async (e)=>{
      const f = e.target.files[0];
      if(!f || f.type !== 'application/pdf'){ splitInfo.textContent = 'Choose a PDF file.'; state.split = null; refreshUploadedUI(); return; }
      splitInfo.textContent = `Selected: ${f.name}`;
      const buf = await readFileAsArrayBuffer(f);
      state.split = { file: f, buffer: buf };
      refreshUploadedUI();
    });

    clearSplit.addEventListener('click', ()=>{ splitFile.value=''; pagesSpec.value=''; state.split=null; splitInfo.textContent=''; refreshUploadedUI(); });

    function parseSpec(spec, total){
      if(!spec) return [];
      const parts = spec.split(',').map(s=>s.trim()).filter(Boolean);
      const set = new Set();
      for(const p of parts){
        if(p.includes('-')){
          const [a,b] = p.split('-').map(x=>parseInt(x,10));
          if(Number.isFinite(a) && Number.isFinite(b)){
            for(let i=Math.max(1,a); i<=Math.min(b,total); i++) set.add(i-1);
          }
        } else {
          const v = parseInt(p,10);
          if(Number.isFinite(v) && v>=1 && v<=total) set.add(v-1);
        }
      }
      return Array.from(set).sort((a,b)=>a-b);
    }

    splitBtn.addEventListener('click', async ()=>{
      if(!state.split || !state.split.buffer){ splitInfo.textContent = 'Choose a PDF to split.'; return; }
      const spec = pagesSpec.value.trim();
      showOverlay(true);
      splitInfo.textContent = 'Processing...';
      try {
        const src = await PDFDocument.load(state.split.buffer);
        const total = src.getPageCount();
        const indices = parseSpec(spec, total);
        if(!indices.length){ splitInfo.textContent = 'No valid pages selected.'; showOverlay(false); return; }
        const outDoc = await PDFDocument.create();
        const copied = await outDoc.copyPages(src, indices);
        copied.forEach(p => outDoc.addPage(p));
        const outBytes = await outDoc.save();
        downloadBlob(outBytes, 'knobly-split.pdf');
        splitInfo.textContent = `Created (${indices.length}) pages`;
      } catch(err){
        splitInfo.textContent = 'Error splitting file.';
      } finally { showOverlay(false); setTimeout(()=>splitInfo.textContent='',2000); }
    });

    /* ========= Extract text logic ========= */
    textFile.addEventListener('change', async (e)=>{
      const f = e.target.files[0];
      if(!f || f.type !== 'application/pdf'){ extractInfo.textContent = 'Select a PDF file.'; state.extract = null; refreshUploadedUI(); return; }
      const buf = await readFileAsArrayBuffer(f);
      state.extract = { file: f, buffer: buf };
      extractInfo.textContent = `Selected: ${f.name}`;
      refreshUploadedUI();
    });

    clearExtract.addEventListener('click', ()=>{ textFile.value=''; extracted.textContent=''; extractInfo.textContent=''; state.extract=null; refreshUploadedUI(); });

    extractBtn.addEventListener('click', async ()=>{
      if(!state.extract || !state.extract.buffer){ extractInfo.textContent = 'Select a PDF first.'; return; }
      showOverlay(true);
      extractInfo.textContent = 'Extracting...';
      extracted.textContent = '';
      try {
        const uint8 = new Uint8Array(state.extract.buffer);
        const loadingTask = pdfjsLib.getDocument({ data: uint8 });
        const pdf = await loadingTask.promise;
        const max = pdf.numPages;
        let full = '';
        for(let p=1;p<=max;p++){
          const page = await pdf.getPage(p);
          const content = await page.getTextContent();
          const strings = content.items.map(i=>i.str);
          full += strings.join(' ') + '\n\n';
          extractInfo.textContent = `Extracted ${p}/${max}`;
        }
        extracted.textContent = full || '[No text found — might be scanned pages]';
        extractInfo.textContent = 'Done';
      } catch(err){
        extracted.textContent = '[Error extracting text]';
        extractInfo.textContent = 'Error';
      } finally{ showOverlay(false); setTimeout(()=>extractInfo.textContent='',2000); }
    });

    /* ========= Images → PDF ========= */
    imgFiles.addEventListener('change', async (e)=>{
      const files = Array.from(e.target.files || []).filter(f=>f.type.startsWith('image/'));
      state.images = files.map(f=>({ file: f }));
      imgInfo.textContent = `${state.images.length} image(s) selected`;
      refreshUploadedUI();
      // pre-read dataUrls
      for(const im of state.images){
        if(!im.dataUrl) im.dataUrl = await readFileAsDataURL(im.file);
      }
    });

    clearImg.addEventListener('click', ()=>{ imgFiles.value=''; state.images=[]; imgInfo.textContent=''; refreshUploadedUI(); });

    imgToPdfBtn.addEventListener('click', async ()=>{
      if(!state.images.length){ imgInfo.textContent = 'Select images first.'; return; }
      showOverlay(true);
      imgInfo.textContent = 'Creating PDF...';
      try {
        const pdfDoc = await PDFDocument.create();
        for(const im of state.images){
          // make sure we have dataUrl
          if(!im.dataUrl) im.dataUrl = await readFileAsDataURL(im.file);
          const dataUrl = im.dataUrl;
          const isPng = dataUrl.startsWith('data:image/png');
          const uint8 = await (await fetch(dataUrl)).arrayBuffer();
          let embedded;
          if(isPng) embedded = await pdfDoc.embedPng(uint8);
          else embedded = await pdfDoc.embedJpg(uint8);
          const page = pdfDoc.addPage([embedded.width, embedded.height]);
          page.drawImage(embedded, { x:0, y:0, width:embedded.width, height:embedded.height });
        }
        const out = await pdfDoc.save();
        downloadBlob(out, 'knobly-images.pdf');
        imgInfo.textContent = 'PDF created';
      } catch(err){
        imgInfo.textContent = 'Error creating PDF';
      } finally{ showOverlay(false); setTimeout(()=>imgInfo.textContent='',1800); }
    });

    /* ========= Notes (localStorage) ========= */
    const NOTES_KEY = 'knobly_pdf_notes_v2';
    function loadNotes(){ const raw = localStorage.getItem(NOTES_KEY); let arr = []; try{ arr = raw ? JSON.parse(raw) : []; }catch(e){ arr=[] } notesList.innerHTML = arr.length? arr.slice().reverse().map(n=>`<div style="padding:8px;border-radius:8px;background:#fbfeff;margin-bottom:8px"><div style="font-weight:700">${escapeHtml(n.title||'Untitled')}</div><div style="font-size:12px;color:var(--muted);margin-top:4px">${new Date(n.ts).toLocaleString()}</div><div style="margin-top:6px">${escapeHtml(n.body).replace(/\n/g,'<br>')}</div></div>`).join('') : '<div class="muted">No notes</div>'; }
    function escapeHtml(s){ if(!s) return ''; return s.replace(/[&<>"']/g, (m)=> ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

    saveNote.addEventListener('click', ()=>{
      const t = noteTitle.value.trim(); const b = noteBody.value.trim();
      const raw = localStorage.getItem(NOTES_KEY); let arr = []; try{ arr = raw ? JSON.parse(raw) : []; }catch(e){ arr = [] }
      arr.push({ title: t, body: b, ts: Date.now() });
      localStorage.setItem(NOTES_KEY, JSON.stringify(arr));
      noteTitle.value=''; noteBody.value='';
      loadNotes();
      saveNote.textContent = 'Saved ✓';
      setTimeout(()=>saveNote.textContent='Save Note',900);
    });

    clearNote.addEventListener('click', ()=>{ noteTitle.value=''; noteBody.value=''; });

    loadNotes();

    /* init UI */
    refreshUploadedUI();

    // small accessibility: keyboard shortcut for save note: Ctrl/Cmd + S
    document.addEventListener('keydown', (e)=>{
      if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's'){ e.preventDefault(); saveNote.click(); }
    });
  </script>
</body>
</html>
